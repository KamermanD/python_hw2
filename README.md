# Фитнес-бот для Telegram

Telegram-бот для здоровья и фитнеса, который помогает пользователю отслеживать потребление воды, калории и физическую активность.

## Демонстрация работы

Rutub: https://rutube.ru/video/2c8a740ffe89e39ce0adcca03f372ca1/

## Деплой (доказательство)

Rutub: https://rutube.ru/video/a649e7c9c140ac465daa4303cf0b7077/

## Основные возможности

-  Отслеживание потребления воды с умными рекомендациями:
  - На основе веса пользователя
  - С учётом уровня активности
  - С учётом погодных условий
-  Подсчёт калорий:
  - Логирование еды через FatSecret API
  - Расчёт BMR и корректировка с учётом активности
-  Логирование тренировок
-  Визуализация прогресса с помощью графиков
-  Интеграция с OpenWeatherMap API для рекомендаций по воде

---

## Технологии

- Python 3.10+
- aiogram 3.x (асинхронный фреймворк для Telegram-ботов)
- aiohttp (асинхронные HTTP-запросы)
- matplotlib (генерация графиков)
- python-dotenv (работа с переменными окружения)
- FatSecret API (информация о продуктах)
- OpenWeatherMap API (данные о погоде)
- Docker (контейнеризация)

---

## Структура проекта

```

src/
├── bot.py        # Основная логика бота и обработчики команд
├── config.py     # Конфигурация, переменные окружения, константы и логгер
├── models.py     # Модели данных (UserProfile, DayRecord)
└── utils.py      # Вспомогательные функции (API, расчёты, графики)

.env              # Переменные окружения (токены и ключи)
requirements.txt  # Python-зависимости
Dockerfile        # Dockerfile для сборки контейнера
README.md         # Этот файл
```
---

## Архитектура

### Модели данных (`models.py`)

- **UserProfile**: хранит данные пользователя и статистику
  - Вес, рост, возраст, уровень активности, город
  - Дневные записи (`DayRecord`) с водой, калориями и тренировками
- **DayRecord**: ежедневная статистика
  - Потребление воды и калорий
  - Сожжённые калории и цели на день
  - Логи еды и тренировок
  - Температура в городе

### Конфигурация (`config.py`)

- Загрузка переменных окружения через `.env`
- Настройка логирования
- Константы для расчёта нормы воды и калорий
- Проверка обязательных переменных окружения

### Управление состоянием (FSM)

Используется **Finite State Machine (FSM)** для:
- Настройки профиля пользователя
- Логирования еды
- Логирования воды
- Логирования тренировок
- Истории и статистики

---

### Основные команды бота (`bot.py`)

- `/start` — запуск и приветствие
- `/profile` — заполнение профиля пользователя
- `/water <мл>` — запись выпитой воды
- `/food <название еды>` — логирование еды с FatSecret
- `/workout <тип> <мин>` — запись тренировки
- `/progress` — просмотр текущего прогресса
- `/charts` — генерация графиков прогресса
- `/history` — просмотр истории за выбранный период

---

## Логирование

- Все сообщения пользователей логируются через `ActivityLoggerMiddleware`
- Профиль должен быть заполнен, иначе блокируется выполнение команд через `UserProfileGuardMiddleware`
- Логи выводятся в консоль с указанием времени и ID пользователя

---

## Деплой

### Локально с Docker

1. Создайте файл `.env` с переменными:

- BOT_TOKEN=ваш_токен_бота
- WEATHER_API_KEY=ключ_OpenWeatherMap
- CONSUMER_KEY=ключ_FatSecret
- CONSUMER_SECRET=секрет_FatSecret
- LOG_LEVEL=DEBUG

2. Соберите контейнер и запустите бота:

- docker build -t fitness-bot .
- docker run -it --env-file .env fitness-bot

### Как работает бот

- Пользователь запускает /start.
- Затем выполняет /profile и вводит вес, рост, возраст, уровень активности и город.
- Бот рассчитывает нормы воды и калорий на день.
- Пользователь добавляет данные через /water, /food, /workout.
- Бот хранит статистику в памяти (в UserProfile.days) и показывает прогресс через /progress и /charts.
- История доступна через /history.

### Настройки и константы (`config.py`)

- WATER_PER_KG — мл воды на кг веса
- WATER_PER_ACTIVITY — мл воды на 30 минут активности
- WATER_PER_WORKOUT — мл воды на 30 минут тренировки
- WATER_HOT_WEATHER — бонус при температуре ≥26°C
- WORKOUT_CALORIES — калории, сжигаемые за минуту разных тренировок

### Хранение данных

- В памяти через словари users и UserProfile.days
- В будущем можно добавить базу данных для постоянного хранения
